function replaceHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function getUrlVar(e,t){var a=String(e).split("?"),i="";if(a[1])for(var l=a[1].split("&"),r=0;r<=l.length;r++)if(l[r]){var n=l[r].split("=");n[0]&&n[0]==t&&(i=n[1])}return i}function syncImgCbs(){$('#adv_ajaxfilter input.filtered[type="checkbox"]').each(function(){var e=$(this).next("img");e.length&&($(this).is(":checked")?e.addClass("selected"):e.removeClass("selected"))})}function filter(e,t){var a=$("#adv_ajaxfilter").serialize().replace(/[^&]+=\.?(?:&|$)/g,"").replace(/&+$/,""),i=getContainer();e||(window.location.hash=a);var l=a.hashCode(),r=$("#adv_ajaxfilter_route").val(),n=$("#adv_ajaxfilter_url").val(),o=$(i);!t&&"product/adv_ajaxfilter"!=r&&o.length<1&&(window.location=n+"#"+a),cache[l]?adv_result(cache[l]):($(i).advOverlay(),$("#adv_ajaxfilter").advOverlay(),$.ajax({url:"index.php?route=module/adv_ajaxfilter/getproducts",type:"POST",data:a+(e?"&getPriceLimits=true":""),dataType:"json",success:function(t){adv_result(t,e),cache[l]=t;var a=getContainer();$(a).advUnoverlay(),$("#adv_ajaxfilter").advUnoverlay()}}))}function adv_result(e,t){var a=getContainer(),i=$.totalStorage("display"),l=window.location.hash.substr(1);e.result_html&&l&&($(a).html(e.result_html),"undefined"!=typeof display&&display(i?i:"list"),afterload(),$(".pagination").html(e.pagination),t&&e.min_price==e.max_price&&$(".price_slider").hide());var r=parseInt(e.min_price),n=Math.ceil(parseFloat(e.max_price));if(t&&($("#slider-range").slider("option",{min:r,max:n}),$("#max_price").val()>=1&&(r=parseInt($("#min_price").val()),n=parseInt($("#max_price").val())),$("#slider-range").slider("option",{values:[r,n]}),$("#min_price").val(r),$("#max_price").val(n)),e.totals_data){e.totals_data.tags.length?($("#filter_tags").html(""),$.tmpl(tag_tmpl,e.totals_data.tags).appendTo("#filter_tags"),$("#filter_tags").parents(".option_box").show()):$("#filter_tags").parents(".option_box").hide(),$("#filter_categories").html(""),e.totals_data.categories.length?($.tmpl(cat_tmpl,e.totals_data.categories).appendTo("#filter_categories"),$("#filter_categories").parents(".option_box").show()):$("#filter_categories").parents(".option_box").hide();var o={};$.each(e.totals_data.attributes,function(e,t){o[(t.id+"_"+t.text).replace(/\s/g,"_")]=t.t}),$(".a_name").each(function(e,t){var a=$(t).attr("at_v_i").replace(/\s/g,"_"),i=replaceHtml(a);o[a]?($('[at_v_t="'+i+'"]').text($('[at_v_t="'+i+'"]').attr("data-value")+" ("+o[a]+")"),$(t).removeAttr("disabled")):($('[at_v_t="'+i+'"]').text($('[at_v_t="'+i+'"]').attr("data-value")),$(t).attr("disabled","disabled"),$(t).removeAttr("checked"),$(t).removeAttr(":selected"))});var s=[];$.each(e.totals_data.manufacturers,function(e,t){if(t.id){s[s.length]=t.id;var a=$("#manufacturer_"+t.id);if(0==a.length)return;a.removeAttr("disabled"),"OPTION"==a.get(0).tagName?a.text($("#m_"+t.id).val()+" ("+t.t+")"):$('label[for="manufacturer_'+t.id+'"]').text($("#m_"+t.id).val()+" ("+t.t+")")}}),$(".manufacturer_value").each(function(){var e=$(this),t=e.attr("id").match(/manufacturer_(\d+)/);$.inArray(t[1],s)<0&&(e.attr("disabled","disabled"),"OPTION"==this.tagName?(e.text($("#m_"+t[1]).val()),e.prop("selected",!1)):($('label[for="manufacturer_'+t[1]+'"]').text($("#m_"+t[1]).val()),e.prop("checked",!1)))});var d=[];$.each(e.totals_data.options,function(e,t){if(t.id){d[d.length]=t.id;var a=$("#option_value_"+t.id);a.length&&(a.removeAttr("disabled"),"OPTION"==a.get(0).tagName?a.text($("#o_"+t.id).val()+" ("+t.t+")"):$('label[for="option_value_'+t.id+'"]').text($("#o_"+t.id).val()+" ("+t.t+")"))}}),$(".option_value").each(function(){var e=$(this),t=e.attr("id").match(/option_value_(\d+)/);$.inArray(t[1],d)<0&&(e.attr("disabled","disabled"),"OPTION"==this.tagName?(e.text($("#o_"+t[1]).val()),e.attr("selected",!1)):($('label[for="option_value_'+t[1]+'"]').text($("#o_"+t[1]).val()),e.attr("checked",!1)))})}}function getContainer(){var e=$.totalStorage("display");return e||(e=$("#adv_ajaxfilter_container").val()),".product-"+e}function delayedFilter(){clearTimeout(timeoutID),$("#adv_ajaxfilter_page").val(0),timeoutID=setTimeout("filter(false, false)",delay)}var timeoutID=0,cache=[],delay=1,container="",tag_tmpl=$.template(null,'<li><label><input id="tag_${tag}" class="filtered" type="checkbox" name="tags[]" value="${tag}" {{if checked}} checked="checked" {{/if}}><span for="tag_${tag}">${name}</span></label></li>'),cat_tmpl=$.template(null,'<li><label><input id="cat_${category_id}" class="filtered" type="checkbox" name="categories[]" value="${category_id}" {{if checked}} checked="checked" {{/if}}><span for="cat_${category_id}">${name}</span></label></li>');Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var a=t||0,i=this.length;i>a;a++)if(this[a]===e)return a;return-1}),String.prototype.hashCode=function(){var e,t,a=0;if(0==this.length)return a;for(e=0;e<this.length;e++)t=this.charCodeAt(e),a=(a<<5)-a+t,a&=a;return a},$(document).on("change",".price_limit",function(){var e=parseInt($("#min_price").val()),t=parseInt($("#max_price").val());$("#slider-range").slider("values",[e,t]),delayedFilter()}),$(document).on("change","#adv_ajaxfilter .filtered",function(){delayedFilter()}),$(function(){$("#slider-range").slider({range:!0,min:0,max:0,values:[0,0],stop:function(){delayedFilter()},slide:function(e,t){$("#min_price").val(t.values[0]),$("#max_price").val(t.values[1])}}),$("#min_price").val($("#slider-range").slider("values",0)),$("#max_price").val($("#slider-range").slider("values",1))}),$(document).ready(function(){container=getContainer(),$(".option_box .option_name").click(function(){$(this).siblings(".collapsible").toggle(),$(this).toggleClass("hided")}),$(".option_box .attribute_group_name").click(function(){$(this).siblings(".attribute_box").toggle(),$(this).toggleClass("hided")}),$(".clear_filter").click(function(){$("#adv_ajaxfilter img").removeClass("selected"),$("#adv_ajaxfilter select").val(""),$("#adv_ajaxfilter :input").each(function(){$(this).is(":checked")&&$(this).attr("checked",!1)});var e=$("#slider-range").slider("option","min"),t=$("#slider-range").slider("option","max");$("#slider-range").slider("option",{values:[e,t]}),$("#min_price").val(e),$("#max_price").val(t),$("div[id^=slider-range-]").each(function(e,t){var a=this.id.replace(/[^\d]/g,""),i=$(t).slider("option","min"),l=$(t).slider("option","max");hs=$(t).slider(),hs.slider("option",{values:[i,l]}),hs.slider("option","slide").call(hs,null,{handle:$(".ui-slider-handle",hs),values:[i,l]}),$("#attribute_value_"+a+"_min").val(""),$("#attribute_value_"+a+"_max").val("")}),delayedFilter()}),$(document).on("click",".pagination a",function(){var e=$(this).attr("href"),t=e.match(/page=(\d+)/);$("#adv_ajaxfilter_page").val(t[1]),filter(!1);var a=getContainer();return $("html, body").animate({scrollTop:$(a).offset().top},"slow"),!1}),$(".sort select").length&&($(".sort select").get(0).onchange=null,$(".sort select").change(function(){var e=$(this).val(),t=getUrlVar(e,"sort"),a=getUrlVar(e,"order");$("#adv_ajaxfilter_sort").val(t),$("#adv_ajaxfilter_order").val(a),delayedFilter()})),$(".limit select").length&&($(".limit select").get(0).onchange=null,$(".limit select").change(function(){$("#adv_ajaxfilter_limit").val(getUrlVar($(this).val(),"limit")),delayedFilter()}));var e=window.location.hash.substr(1);e&&$("instock").is(":visible")&&$("instock").is(":checked")&&$("instock").attr("checked",!1),$("#adv_ajaxfilter").deserialize(e),syncImgCbs(),$("#adv_ajaxfilter img").bind("click",function(){var e=$(this).prev("input");e.attr("disabled")||($(this).toggleClass("selected"),e.prop("checked",!e.prop("checked")),delayedFilter())}),$("div[id^=slider-range-]").each(function(e,t){var a=this.id.replace(/[^\d]/g,""),i=window["attr_arr_"+a],l=parseInt($("#attribute_value_"+a+"_min").val()),r=parseInt($("#attribute_value_"+a+"_max").val());l=i.indexOf(l),r=i.indexOf(r),r>=0&&l>=0&&(hs=$(t).slider(),hs.slider("option",{values:[l,r]}),hs.slider("option","slide").call(hs,null,{handle:$(".ui-slider-handle",hs),values:[l,r]}))}),$(".sort select").length&&($("#adv_ajaxfilter_sort").val()?$(".sort select").each(function(){return getUrlVar($(this).val(),"sort")==$("#adv_ajaxfilter_sort").val()&&getUrlVar($(this).val(),"order")==$("#adv_ajaxfilter_order").val()?void $(".sort select").val($(this).val()):void 0}):($val=$(".sort select").val(),$("#adv_ajaxfilter_sort").val(getUrlVar($val,"sort")),$("#adv_ajaxfilter_order").val(getUrlVar($val,"order")))),$("#adv_ajaxfilter_limit").length&&($("#adv_ajaxfilter_limit").val()?$(".limit select").val($("#adv_ajaxfilter_limit").val()):$("#adv_ajaxfilter_limit").val(getUrlVar($(".limit select").val(),"limit"))),filter(!0,!0)});